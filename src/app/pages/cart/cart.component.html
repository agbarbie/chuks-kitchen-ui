<!-- Header -->
<div class="page-header">
  <h1>ğŸ›’ Your Cart</h1>
  <p>Review your order before checking out</p>
</div>

<div class="cart-layout">

  <!-- LEFT: Cart Items -->
  <div class="cart-panel">
    <div class="cart-panel-header">
      <h2>Order Items <span class="item-count">({{ cart.totalItems() }})</span></h2>
      <button class="clear-btn" (click)="clearCart()">Clear All</button>
    </div>

    @if (cart.cartItems().length === 0) {
      <div class="cart-empty">
        <div class="cart-empty-icon">ğŸ›’</div>
        <h3>Your cart is empty</h3>
        <p>Add some delicious meals from our menu</p>
        <a routerLink="/menu" class="btn-primary">Browse Menu</a>
      </div>
    } @else {
      @for (ci of cart.cartItems(); track ci.item.id) {
        <div class="cart-item">
          <div class="cart-item-img">{{ ci.item.emoji }}</div>
          <div class="cart-item-info">
            <div class="cart-item-name">{{ ci.item.name }}</div>
            <div class="cart-item-price">
              â‚¦{{ (ci.item.price * ci.qty).toLocaleString() }}
            </div>
          </div>
          <div class="cart-item-controls">
            <div class="qty-control">
              <button class="qty-btn" (click)="changeQty(ci.item.id, -1)">âˆ’</button>
              <span class="qty-num">{{ ci.qty }}</span>
              <button class="qty-btn" (click)="changeQty(ci.item.id, 1)">+</button>
            </div>
            <button class="remove-btn" (click)="removeItem(ci.item.id)">Remove</button>
          </div>
        </div>
      }
    }
  </div>

  <!-- RIGHT: Summary + Form -->
  <aside class="order-summary">
    <h2>Order Summary</h2>

    @for (ci of cart.cartItems(); track ci.item.id) {
      <div class="summary-row">
        <span>{{ ci.item.name }} Ã— {{ ci.qty }}</span>
        <span>â‚¦{{ (ci.item.price * ci.qty).toLocaleString() }}</span>
      </div>
    }

    <div class="summary-row">
      <span>Delivery Fee</span>
      <span>{{ cart.deliveryFee() === 0 ? 'FREE ğŸ‰' : 'â‚¦500' }}</span>
    </div>
    <div class="summary-row total">
      <span>Total</span>
      <span>â‚¦{{ cart.total().toLocaleString() }}</span>
    </div>

    @if (freeDeliveryLeft > 0) {
      <div class="delivery-note">
        ğŸ‰ Add â‚¦{{ freeDeliveryLeft.toLocaleString() }} more for free delivery!
      </div>
    } @else {
      <div class="delivery-note success">
        âœ… You qualify for <strong>free delivery!</strong>
      </div>
    }

    <!-- Delivery Form -->
    <div class="delivery-form">
      <h3>ğŸ“ Delivery Details</h3>
      <div class="form-group">
        <label>Full Name</label>
        <input type="text" placeholder="e.g. Amaka Okafor"
               [value]="name()"
               (input)="onInput('name', $event)" />
      </div>
      <div class="form-group">
        <label>Phone Number</label>
        <input type="tel" placeholder="+234 801 000 0000"
               [value]="phone()"
               (input)="onInput('phone', $event)" />
      </div>
      <div class="form-group">
        <label>Delivery Address</label>
        <textarea rows="2" placeholder="House number, street, area..."
                  [value]="address()"
                  (input)="onInput('address', $event)"></textarea>
      </div>
      <div class="form-group">
        <label>Payment Method</label>
        <select [value]="payMethod()"
                (change)="onInput('payMethod', $event)">
          <option value="">Select payment</option>
          <option value="transfer">Bank Transfer</option>
          <option value="cash">Pay on Delivery</option>
          <option value="card">Debit Card</option>
        </select>
      </div>
    </div>

    <button class="checkout-btn" (click)="placeOrder()">
      Place Order â†’
    </button>
  </aside>

</div>

<!-- Confirmation Modal -->
<div class="modal-overlay" [class.show]="modalVisible()">
  <div class="modal">
    <div class="modal-icon">ğŸ‰</div>
    <h2>Order Placed!</h2>
    <p>Your order has been received and is being prepared.</p>
    <div class="order-id">{{ orderId() }}</div>
    <p class="order-id-note">Save this ID to track your order</p>
    <div class="modal-actions">
      <a [routerLink]="['/track']"
         [queryParams]="{id: orderId()}"
         class="btn-primary">Track Order</a>
      <button class="btn-outline" (click)="closeModal()">Done</button>
    </div>
  </div>
</div>

<app-toast [message]="toastMsg()" [visible]="toastVisible()"></app-toast>